#!/usr/bin/env bash

# Kill existing polybar instances
killall -q polybar
while pgrep -u "$UID" -x polybar >/dev/null; do sleep 0.2; done

# Get active network interface (excluding VPN interfaces)
get_active_interface() {
  local iface
  iface=$(ip route get 8.8.8.8 2>/dev/null | grep -oP 'dev \K\S+')

  # Skip VPN interfaces
  if [[ "$iface" =~ ^(tun|tap|wg) ]]; then
    iface=$(ip route show default | grep -v 'tun\|tap\|wg' | awk '{print $5}' | head -n1)
  fi

  echo "$iface"
}

IFACE=$(get_active_interface)

# Determine interface type
if [[ -d "/sys/class/net/$IFACE/wireless" ]]; then
  IFACE_TYPE="wireless"
else
  IFACE_TYPE="wired"
fi

export IFACE_TYPE
polybar -r default &
